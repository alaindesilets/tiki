<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GUI.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>GUI.php</h1><div class="fragment"><pre>00001 &lt;?php
00002 <span class="keyword">class </span>GUI <span class="keyword">extends</span> Base {
00003 
00016   function gui_list_user_processes($user,$offset,$maxRecords,$sort_mode,$find,$where='')
00017   {
00018     $sort_mode = str_replace(<span class="stringliteral">"_"</span>,<span class="stringliteral">" "</span>,$sort_mode);
00019     <span class="keywordflow">if</span>($find) {
00020       $mid=<span class="stringliteral">" and ((name like '%"</span>.$find.<span class="stringliteral">"%') or (description like '%"</span>.$find.<span class="stringliteral">"%'))"</span>;
00021     } <span class="keywordflow">else</span> {
00022       $mid=<span class="stringliteral">""</span>;
00023     }
00024     <span class="keywordflow">if</span>($where) {
00025       <span class="keywordflow">if</span>($mid) {
00026         $mid.= <span class="stringliteral">" and ($where) "</span>;
00027       } <span class="keywordflow">else</span> {
00028         $mid.= <span class="stringliteral">" and ($where) "</span>;
00029       }
00030     }
00031     
00032     $query = <span class="stringliteral">"select distinct(gp.pId), </span>
00033 <span class="stringliteral">                                 gp.isActive,                    </span>
00034 <span class="stringliteral">                     gp.name as procname, </span>
00035 <span class="stringliteral">                     gp.version as version</span>
00036 <span class="stringliteral">              from</span>
00037 <span class="stringliteral">                galaxia_processes gp INNER JOIN galaxia_activities ga ON gp.pId=ga.pId</span>
00038 <span class="stringliteral">                INNER JOIN galaxia_activity_roles gar ON gar.activityId=ga.activityId</span>
00039 <span class="stringliteral">                INNER JOIN galaxia_roles gr ON gr.roleId=gar.roleId</span>
00040 <span class="stringliteral">                INNER JOIN galaxia_user_roles gur ON gur.roleId=gr.roleId</span>
00041 <span class="stringliteral">              where gp.isActive='y' and user='$user'</span>
00042 <span class="stringliteral">                            $mid order by $sort_mode limit $offset,$maxRecords"</span>;
00043     $query_cant = <span class="stringliteral">"select count(distinct(gp.pId)) from</span>
00044 <span class="stringliteral">                galaxia_processes gp INNER JOIN galaxia_activities ga ON gp.pId=ga.pId</span>
00045 <span class="stringliteral">                INNER JOIN galaxia_activity_roles gar ON gar.activityId=ga.activityId</span>
00046 <span class="stringliteral">                INNER JOIN galaxia_roles gr ON gr.roleId=gar.roleId</span>
00047 <span class="stringliteral">                INNER JOIN galaxia_user_roles gur ON gur.roleId=gr.roleId</span>
00048 <span class="stringliteral">              where gp.isActive='y' and gur.user='$user' $mid"</span>;
00049     $result = $this-&gt;query($query);
00050     $cant = $this-&gt;getOne($query_cant);
00051     $ret = Array();
00052     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00053       <span class="comment">// Get instances per activity</span>
00054       $pId=$res['pId'];
00055       $res['activities']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_processes gp INNER JOIN galaxia_activities ga ON gp.pId=ga.pId INNER JOIN galaxia_activity_roles gar ON gar.activityId=ga.activityId</span>
00056 <span class="stringliteral">                INNER JOIN galaxia_roles gr ON gr.roleId=gar.roleId</span>
00057 <span class="stringliteral">                INNER JOIN galaxia_user_roles gur ON gur.roleId=gr.roleId</span>
00058 <span class="stringliteral">                where gp.pId=$pId and gur.user='$user'"</span>);
00059           $res['instances']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_instances gi INNER JOIN galaxia_instance_activities gia ON gi.instanceId=gia.instanceId INNER JOIN galaxia_activity_roles gar ON gia.activityId=gar.activityId INNER JOIN galaxia_user_roles gur ON gar.roleId=gur.roleId where gi.pId=$pId and ((gia.user='$user') or (gia.user='*' and gur.user='$user'))"</span>);                  
00060       $ret[] = $res;
00061     }
00062     $retval = Array();
00063     $retval[<span class="stringliteral">"data"</span>] = $ret;
00064     $retval[<span class="stringliteral">"cant"</span>] = $cant;
00065     <span class="keywordflow">return</span> $retval;
00066   }
00067 
00068 
00069   function gui_list_user_activities($user,$offset,$maxRecords,$sort_mode,$find,$where='')
00070   {
00071     $sort_mode = str_replace(<span class="stringliteral">"_"</span>,<span class="stringliteral">" "</span>,$sort_mode);
00072     <span class="keywordflow">if</span>($find) {
00073       $mid=<span class="stringliteral">" and ((name like '%"</span>.$find.<span class="stringliteral">"%') or (description like '%"</span>.$find.<span class="stringliteral">"%'))"</span>;
00074     } <span class="keywordflow">else</span> {
00075       $mid=<span class="stringliteral">""</span>;
00076     }
00077     <span class="keywordflow">if</span>($where) {
00078       <span class="keywordflow">if</span>($mid) {
00079         $mid.= <span class="stringliteral">" and ($where) "</span>;
00080       } <span class="keywordflow">else</span> {
00081         $mid.= <span class="stringliteral">" and ($where) "</span>;
00082       }
00083     }
00084     
00085     $query = <span class="stringliteral">"select distinct(ga.activityId),                     </span>
00086 <span class="stringliteral">                                 ga.name,</span>
00087 <span class="stringliteral">                                 ga.type,</span>
00088 <span class="stringliteral">                     gp.name as procname, </span>
00089 <span class="stringliteral">                     ga.isInteractive,</span>
00090 <span class="stringliteral">                     ga.isAutoRouted,</span>
00091 <span class="stringliteral">                     ga.activityId,</span>
00092 <span class="stringliteral">                     gp.version as version,</span>
00093 <span class="stringliteral">                     gp.pId,</span>
00094 <span class="stringliteral">                     gp.isActive</span>
00095 <span class="stringliteral">              from</span>
00096 <span class="stringliteral">                galaxia_processes gp INNER JOIN galaxia_activities ga ON gp.pId=ga.pId</span>
00097 <span class="stringliteral">                INNER JOIN galaxia_activity_roles gar ON gar.activityId=ga.activityId</span>
00098 <span class="stringliteral">                INNER JOIN galaxia_roles gr ON gr.roleId=gar.roleId</span>
00099 <span class="stringliteral">                INNER JOIN galaxia_user_roles gur ON gur.roleId=gr.roleId</span>
00100 <span class="stringliteral">              where gp.isActive='y' and user='$user'</span>
00101 <span class="stringliteral">                            $mid order by $sort_mode limit $offset,$maxRecords"</span>;
00102     $query_cant = <span class="stringliteral">"select count(distinct(gp.pId)) from</span>
00103 <span class="stringliteral">                galaxia_processes gp INNER JOIN galaxia_activities ga ON gp.pId=ga.pId</span>
00104 <span class="stringliteral">                INNER JOIN galaxia_activity_roles gar ON gar.activityId=ga.activityId</span>
00105 <span class="stringliteral">                INNER JOIN galaxia_roles gr ON gr.roleId=gar.roleId</span>
00106 <span class="stringliteral">                INNER JOIN galaxia_user_roles gur ON gur.roleId=gr.roleId</span>
00107 <span class="stringliteral">              where gp.isActive='y' and gur.user='$user' $mid"</span>;
00108     $result = $this-&gt;query($query);
00109     $cant = $this-&gt;getOne($query_cant);
00110     $ret = Array();
00111     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00112       <span class="comment">// Get instances per activity</span>
00113           $res['instances']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_instances gi INNER JOIN galaxia_instance_activities gia ON gi.instanceId=gia.instanceId INNER JOIN galaxia_activity_roles gar ON gia.activityId=gar.activityId INNER JOIN galaxia_user_roles gur ON gar.roleId=gur.roleId where gia.activityId="</span>.$res['activityId'].<span class="stringliteral">" and ((gia.user='$user') or (gia.user='*' and gur.user='$user'))"</span>);                
00114       $ret[] = $res;
00115     }
00116     $retval = Array();
00117     $retval[<span class="stringliteral">"data"</span>] = $ret;
00118     $retval[<span class="stringliteral">"cant"</span>] = $cant;
00119     <span class="keywordflow">return</span> $retval;
00120   }
00121 
00122 
00123   function gui_list_user_instances($user,$offset,$maxRecords,$sort_mode,$find,$where='')
00124   {
00125     $sort_mode = str_replace(<span class="stringliteral">"_"</span>,<span class="stringliteral">" "</span>,$sort_mode);
00126     <span class="keywordflow">if</span>($find) {
00127       $mid=<span class="stringliteral">" and ((name like '%"</span>.$find.<span class="stringliteral">"%') or (description like '%"</span>.$find.<span class="stringliteral">"%'))"</span>;
00128     } <span class="keywordflow">else</span> {
00129       $mid=<span class="stringliteral">""</span>;
00130     }
00131     <span class="keywordflow">if</span>($where) {
00132       <span class="keywordflow">if</span>($mid) {
00133         $mid.= <span class="stringliteral">" and ($where) "</span>;
00134       } <span class="keywordflow">else</span> {
00135         $mid.= <span class="stringliteral">" and ($where) "</span>;
00136       }
00137     }
00138     
00139     $query = <span class="stringliteral">"select distinct(gi.instanceId),                     </span>
00140 <span class="stringliteral">                                 gi.started,</span>
00141 <span class="stringliteral">                                 gi.owner,</span>
00142 <span class="stringliteral">                                 gia.user,</span>
00143 <span class="stringliteral">                                 gi.status,</span>
00144 <span class="stringliteral">                                 gia.status as actstatus,</span>
00145 <span class="stringliteral">                                 ga.name,</span>
00146 <span class="stringliteral">                                 ga.type,</span>
00147 <span class="stringliteral">                     gp.name as procname, </span>
00148 <span class="stringliteral">                     ga.isInteractive,</span>
00149 <span class="stringliteral">                     ga.isAutoRouted,</span>
00150 <span class="stringliteral">                     ga.activityId,</span>
00151 <span class="stringliteral">                     gp.version as version,</span>
00152 <span class="stringliteral">                     gp.pId</span>
00153 <span class="stringliteral">              from</span>
00154 <span class="stringliteral">                                galaxia_instances gi </span>
00155 <span class="stringliteral">                                INNER JOIN galaxia_instance_activities gia ON gi.instanceId=gia.instanceId</span>
00156 <span class="stringliteral">                                INNER JOIN galaxia_activities ga ON gia.activityId = ga.activityId</span>
00157 <span class="stringliteral">                                INNER JOIN galaxia_activity_roles gar ON gia.activityId=gar.activityId</span>
00158 <span class="stringliteral">                                INNER JOIN galaxia_user_roles gur ON gur.roleId=gar.roleId</span>
00159 <span class="stringliteral">                                INNER JOIN galaxia_processes gp ON gp.pId=ga.pId</span>
00160 <span class="stringliteral">                                where (gia.user='$user' or (gia.user='*' and gur.user='$user')) $mid order by $sort_mode limit $offset,$maxRecords"</span>;
00161     $query_cant = <span class="stringliteral">"select count(distinct(gp.pId)) from</span>
00162 <span class="stringliteral">                                                                galaxia_instances gi </span>
00163 <span class="stringliteral">                                INNER JOIN galaxia_instance_activities gia ON gi.instanceId=gia.instanceId</span>
00164 <span class="stringliteral">                                INNER JOIN galaxia_activities ga ON gia.activityId = ga.activityId</span>
00165 <span class="stringliteral">                                INNER JOIN galaxia_activity_roles gar ON gia.activityId=gar.activityId</span>
00166 <span class="stringliteral">                                INNER JOIN galaxia_user_roles gur ON gur.roleId=gar.roleId</span>
00167 <span class="stringliteral">                                INNER JOIN galaxia_processes gp ON gp.pId=ga.pId</span>
00168 <span class="stringliteral">                                where (gia.user='$user' or (gia.user='*' and gur.user='$user')) $mid "</span>;
00169     $result = $this-&gt;query($query);
00170     $cant = $this-&gt;getOne($query_cant);
00171     $ret = Array();
00172     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00173       <span class="comment">// Get instances per activity</span>
00174       $ret[] = $res;
00175     }
00176     $retval = Array();
00177     $retval[<span class="stringliteral">"data"</span>] = $ret;
00178     $retval[<span class="stringliteral">"cant"</span>] = $cant;
00179     <span class="keywordflow">return</span> $retval;
00180   }
00181 
00182   function gui_abort_instance($user,$activityId,$instanceId)
00183   {
00184     <span class="comment">// Users can only abort instances belonging to them</span>
00185         <span class="keywordflow">if</span>(!$this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_instance_activities where activityId=$activityId and instanceId=$instanceId and user='$user'"</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00186         $query = <span class="stringliteral">"update galaxia_instances set status='aborted' where instanceId=$instanceId"</span>;
00187         $this-&gt;query($query);
00188                 
00189   }
00190   
00191   function gui_exception_instance($user,$activityId,$instanceId)
00192   {
00193     <span class="comment">// Users can only abort instances belonging to them</span>
00194         <span class="keywordflow">if</span>(!$this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_instance_activities where activityId=$activityId and instanceId=$instanceId and user='$user'"</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;   
00195     $query = <span class="stringliteral">"update galaxia_instances set status='exception' where instanceId=$instanceId"</span>;
00196         $this-&gt;query($query);
00197   }
00198 
00199   
00200   function gui_send_instance($user,$activityId,$instanceId)
00201   {
00202         <span class="keywordflow">if</span>(!
00203           ($this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_instance_activities where activityId=$activityId and instanceId=$instanceId and user='$user'"</span>))
00204           ||
00205           ($this-&gt;getOne(<span class="stringliteral">"select count(*) </span>
00206 <span class="stringliteral">                          from galaxia_instance_activities gia</span>
00207 <span class="stringliteral">                          INNER JOIN galaxia_activity_roles gar ON gar.activityId=gia.activityId</span>
00208 <span class="stringliteral">                          INNER JOIN galaxia_user_roles gur ON gar.roleId=gur.roleId</span>
00209 <span class="stringliteral">                          where gia.instanceId=$instanceId and gia.activityId=$activityId and gia.user='*' and gur.user='$user'</span>
00210 <span class="stringliteral">                                         "</span>))
00211           )
00212           <span class="keywordflow">return</span> <span class="keyword">false</span>; 
00213     include_once('lib/Galaxia/src/API/<a class="code" href="classInstance.html">Instance</a>.php');
00214     $instance = <span class="keyword">new</span> <a class="code" href="classInstance.html">Instance</a>($this-&gt;db);
00215     $instance-&gt;getInstance($instanceId);
00216     $instance-&gt;complete($activityId,<span class="keyword">true</span>,<span class="keyword">false</span>);
00217     unset($instance);  
00218   }
00219   
00220   function gui_release_instance($user,$activityId,$instanceId)
00221   {
00222         <span class="keywordflow">if</span>(!$this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_instance_activities where activityId=$activityId and instanceId=$instanceId and user='$user'"</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00223         $query = <span class="stringliteral">"update galaxia_instance_activities set user='*' where instanceId=$instanceId and activityId=$activityId"</span>;
00224         $this-&gt;query($query);    
00225   }
00226   
00227   function gui_grab_instance($user,$activityId,$instanceId)
00228   {
00229         <span class="comment">// Grab only if roles are ok  </span>
00230         <span class="keywordflow">if</span>(!$this-&gt;getOne(<span class="stringliteral">"select count(*) </span>
00231 <span class="stringliteral">                          from galaxia_instance_activities gia</span>
00232 <span class="stringliteral">                          INNER JOIN galaxia_activity_roles gar ON gar.activityId=gia.activityId</span>
00233 <span class="stringliteral">                          INNER JOIN galaxia_user_roles gur ON gar.roleId=gur.roleId</span>
00234 <span class="stringliteral">                          where gia.instanceId=$instanceId and gia.activityId=$activityId and gia.user='*' and gur.user='$user'</span>
00235 <span class="stringliteral">                                         "</span>))    <span class="keywordflow">return</span> <span class="keyword">false</span>;
00236         $query = <span class="stringliteral">"update galaxia_instance_activities set user='$user' where instanceId=$instanceId and activityId=$activityId"</span>;
00237         $this-&gt;query($query);    
00238   }
00239 }
00240 ?&gt;
</pre></div><hr><address style="align: right;"><small>Generated on Fri Apr 25 16:07:08 2003 for Galaxia by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
