<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Galaxia: BaseActivity.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>BaseActivity.php</h1><div class="fragment"><pre>00001 &lt;?php
00002 include_once (GALAXIA_LIBRARY.'/src/common/<a class="code" href="classBase.html">Base</a>.php');
00005 
<a name="l00011"></a><a class="code" href="classBaseActivity.html">00011</a> <span class="keyword">class </span><a class="code" href="classBaseActivity.html">BaseActivity</a> <span class="keyword">extends</span> <a class="code" href="classBase.html">Base</a> {
00012   var $name;
00013   var $normalizedName;
00014   var $description;
00015   var $isInteractive;
00016   var $isAutoRouted;
00017   var $roles=Array();
00018   var $outbound=Array();
00019   var $inbound=Array();
00020   var $pId;
00021   var $activityId;
00022   
00023   function setDb($db)
00024   {
00025     $this-&gt;db=$db;
00026   }
00027   
00028   function <a class="code" href="classBaseActivity.html">BaseActivity</a>($db)
00029   {
00030     $this-&gt;db=$db;
00031   }
00032   
00033   
<a name="l00038"></a><a class="code" href="classBaseActivity.html#a2">00038</a>   function <a class="code" href="classBaseActivity.html#a2">getActivity</a>($activityId) 
00039   {
00040     $query = <span class="stringliteral">"select * from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities` where `activityId`=?"</span>;
00041     $result = $this-&gt;query($query,array($activityId));
00042     <span class="keywordflow">if</span>(!$result-&gt;numRows()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00043     $res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC);
00044     <span class="keywordflow">switch</span>($res['type']) {
00045       <span class="keywordflow">case</span> 'start':
00046         $act = <span class="keyword">new</span> <a class="code" href="classStart.html">Start</a>($this-&gt;db);  
00047       <span class="keywordflow">break</span>;
00048       <span class="keywordflow">case</span> 'end':
00049         $act = <span class="keyword">new</span> <a class="code" href="classEnd.html">End</a>($this-&gt;db);
00050       <span class="keywordflow">break</span>;
00051       <span class="keywordflow">case</span> 'join':
00052         $act = <span class="keyword">new</span> <a class="code" href="classJoin.html">Join</a>($this-&gt;db);
00053       <span class="keywordflow">break</span>;
00054       <span class="keywordflow">case</span> 'split':
00055         $act = <span class="keyword">new</span> <a class="code" href="classSplit.html">Split</a>($this-&gt;db);
00056       <span class="keywordflow">break</span>;
00057       <span class="keywordflow">case</span> 'standalone':
00058         $act = <span class="keyword">new</span> <a class="code" href="classStandalone.html">Standalone</a>($this-&gt;db);
00059       <span class="keywordflow">break</span>;
00060       <span class="keywordflow">case</span> '<span class="keywordflow">switch</span>':
00061         $act = <span class="keyword">new</span> <a class="code" href="classSwitchActivity.html">SwitchActivity</a>($this-&gt;db);
00062       <span class="keywordflow">break</span>;
00063       <span class="keywordflow">case</span> 'activity':
00064         $act = <span class="keyword">new</span> <a class="code" href="classActivity.html">Activity</a>($this-&gt;db);
00065       <span class="keywordflow">break</span>;
00066       <span class="keywordflow">default</span>:
00067         trigger_error('Unknown activity type:'.$res['type'],E_USER_WARNING);
00068     }
00069     
00070     $act-&gt;setName($res['name']);
00071     $act-&gt;setProcessId($res['pId']);
00072     $act-&gt;setNormalizedName($res['normalized_name']);
00073     $act-&gt;setDescription($res['description']);
00074     $act-&gt;setIsInteractive($res['<a class="code" href="classBaseActivity.html#a12">isInteractive</a>']);
00075     $act-&gt;setIsAutoRouted($res['<a class="code" href="classBaseActivity.html#a14">isAutoRouted</a>']);
00076     $act-&gt;setActivityId($res['activityId']);
00077     
00078     <span class="comment">//Now get forward transitions </span>
00079     
00080     <span class="comment">//Now get backward transitions</span>
00081     
00082     <span class="comment">//Now get roles</span>
00083     $query = <span class="stringliteral">"select `roleId` from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activity_roles` where `activityId`=?"</span>;
00084     $result=$this-&gt;query($query,array($res['activityId']));
00085     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00086       $this-&gt;roles[] = $res['roleId'];
00087     }
00088     $act-&gt;setRoles($this-&gt;roles);
00089     <span class="keywordflow">return</span> $act;
00090   }
00091   
<a name="l00093"></a><a class="code" href="classBaseActivity.html#a3">00093</a>   function <a class="code" href="classBaseActivity.html#a3">getUserRoles</a>($user) {
00094     $query = <span class="stringliteral">"select `roleId` from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"user_roles` where `user`=?"</span>;
00095     $result=$this-&gt;query($query,array($user));
00096     $ret = Array();
00097     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00098       $ret[] = $res['roleId'];
00099     }
00100     <span class="keywordflow">return</span> $ret;
00101   }
00102 
<a name="l00105"></a><a class="code" href="classBaseActivity.html#a4">00105</a>   function <a class="code" href="classBaseActivity.html#a4">getActivityRoleNames</a>() {
00106     $aid = $this-&gt;activityId;
00107     $query = <span class="stringliteral">"select gr.`roleId`, `name` from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activity_roles` gar, `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"roles` gr where gar.`roleId`=gr.`roleId` and gar.`activityId`=?"</span>;
00108     $result=$this-&gt;query($query,array($aid));
00109     $ret = Array();
00110     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00111       $ret[] = $res;
00112     }
00113     <span class="keywordflow">return</span> $ret;
00114   }
00115   
<a name="l00117"></a><a class="code" href="classBaseActivity.html#a5">00117</a>   function <a class="code" href="classBaseActivity.html#a5">getNormalizedName</a>() {
00118         <span class="keywordflow">return</span> $this-&gt;normalizedName;
00119   }
00120 
<a name="l00122"></a><a class="code" href="classBaseActivity.html#a6">00122</a>   function <a class="code" href="classBaseActivity.html#a6">setNormalizedName</a>($name) {
00123     $this-&gt;normalizedName=$name;
00124   }
00125   
<a name="l00127"></a><a class="code" href="classBaseActivity.html#a7">00127</a>   function <a class="code" href="classBaseActivity.html#a7">setName</a>($name) {
00128     $this-&gt;name=$name;
00129   }
00130   
<a name="l00132"></a><a class="code" href="classBaseActivity.html#a8">00132</a>   function <a class="code" href="classBaseActivity.html#a8">getName</a>() {
00133     <span class="keywordflow">return</span> $this-&gt;name;
00134   }
00135   
<a name="l00137"></a><a class="code" href="classBaseActivity.html#a9">00137</a>   function <a class="code" href="classBaseActivity.html#a9">setDescription</a>($desc) {
00138     $this-&gt;description=$desc;
00139   }
00140   
<a name="l00142"></a><a class="code" href="classBaseActivity.html#a10">00142</a>   function <a class="code" href="classBaseActivity.html#a10">getDescription</a>() {
00143     <span class="keywordflow">return</span> $this-&gt;description;
00144   }
00145   
<a name="l00147"></a><a class="code" href="classBaseActivity.html#a11">00147</a>   function <a class="code" href="classBaseActivity.html#a11">setIsInteractive</a>($is) {
00148     $this-&gt;isInteractive=$is;
00149   }
00150   
<a name="l00152"></a><a class="code" href="classBaseActivity.html#a12">00152</a>   function <a class="code" href="classBaseActivity.html#a12">isInteractive</a>() {
00153     <span class="keywordflow">return</span> $this-&gt;isInteractive == <span class="charliteral">'y'</span>;
00154   }
00155   
<a name="l00157"></a><a class="code" href="classBaseActivity.html#a13">00157</a>   function <a class="code" href="classBaseActivity.html#a13">setIsAutoRouted</a>($is) {
00158     $this-&gt;isAutoRouted = $is;
00159   }
00160   
<a name="l00162"></a><a class="code" href="classBaseActivity.html#a14">00162</a>   function <a class="code" href="classBaseActivity.html#a14">isAutoRouted</a>() {
00163     <span class="keywordflow">return</span> $this-&gt;isAutoRouted == <span class="charliteral">'y'</span>;
00164   }
00165 
<a name="l00167"></a><a class="code" href="classBaseActivity.html#a15">00167</a>   function <a class="code" href="classBaseActivity.html#a15">setProcessId</a>($pid) {
00168         $this-&gt;pId=$pid;
00169   }
00170   
<a name="l00172"></a><a class="code" href="classBaseActivity.html#a16">00172</a>   function <a class="code" href="classBaseActivity.html#a16">getProcessId</a>() {
00173     <span class="keywordflow">return</span> $this-&gt;pId;
00174   }
00175 
<a name="l00177"></a><a class="code" href="classBaseActivity.html#a17">00177</a>   function <a class="code" href="classBaseActivity.html#a17">getActivityId</a>() {
00178     <span class="keywordflow">return</span> $this-&gt;activityId;
00179   }  
00180   
<a name="l00182"></a><a class="code" href="classBaseActivity.html#a18">00182</a>   function <a class="code" href="classBaseActivity.html#a18">setActivityId</a>($id) {
00183     $this-&gt;activityId=$id;
00184   }
00185   
<a name="l00187"></a><a class="code" href="classBaseActivity.html#a19">00187</a>   function <a class="code" href="classBaseActivity.html#a19">getRoles</a>() {
00188     <span class="keywordflow">return</span> $this-&gt;roles;
00189   }
00190   
<a name="l00193"></a><a class="code" href="classBaseActivity.html#a20">00193</a>   function <a class="code" href="classBaseActivity.html#a20">setRoles</a>($roles) {
00194     $this-&gt;roles = $roles;
00195   }
00196   
00197 }
00198 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Sep 30 01:24:12 2003 for Galaxia by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
