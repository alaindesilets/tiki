$jq(document).ready(function(){$jq(toolbarsadmin_rowStr).sortable({connectWith:toolbarsadmin_fullStr+', .row',forcePlaceholderSize:true,forceHelperSize:true,receive:function(event,ui){var x=$jq(ui.item).parent().offset().left+$jq(ui.item).parent().width()-ui.offset.left;if(x<32){$jq(ui.item).css("float","right");}else{$jq(ui.item).css("float","left");}}});$jq(toolbarsadmin_fullStr).sortable({connectWith:'.row, #full-list-c',forcePlaceholderSize:true,forceHelperSize:true,remove:function(event,ui){if($jq(ui.item).text()=='-'){$jq(this).prepend($jq(ui.item).clone());}},receive:function(event,ui){$jq(ui.item).css('float','');if($jq(ui.item).text()=='-'){$jq(this).children().remove('.qt--');$jq(this).prepend($jq(ui.item).clone());}else if($jq(this).attr('id')=='full-list-c'){$jq(ui.item).dblclick(function(){showToolEditForm(ui.item);});$jq(ui.item).trigger('dblclick');}sortList(this);},stop:function(event,ui){sortList(this);}});sortList=function(list){var arr=$jq(list).children().get(),item,labelA,labelB;arr.sort(function(a,b){labelA=$jq(a).text().toUpperCase();labelB=$jq(b).text().toUpperCase();if(labelA<labelB){return -1;}if(labelA>labelB){return 1;}return 0;});$jq(list).empty();for(item in arr){$jq(list).append(arr[item]);}};$jq('#full-list-c').sortable({connectWith:'.lists'}).children().each(function(){$jq(this).dblclick(function(){showToolEditForm(this);});});$jq('.qt-custom').dblclick(function(){showToolEditForm(this);});showToolEditForm=function(item){if(item){$jq('#toolbar_edit_div #tool_name').val($jq(item).text());$jq('#toolbar_edit_div #tool_label').val($jq(item).children('img').attr('title'));$jq('#toolbar_edit_div #tool_icon').val($jq(item).children('img').attr('src'));$jq('#toolbar_edit_div #tool_token').val($jq(item).children('input[name=token]').val());$jq('#toolbar_edit_div #tool_syntax').val($jq(item).children('input[name=syntax]').val());$jq('#toolbar_edit_div #tool_type').val($jq(item).children('input[name=type]').val());if($jq(item).children('input[name=type]').val()=='Wikiplugin'){$jq('#toolbar_edit_div #tool_plugin').val($jq(item).children('input[name=plugin]').val());}else{$jq('#toolbar_edit_div #tool_plugin').attr('disabled','disabled');}}$jq('#toolbar_edit_div').dialog('open');};$jq('#toolbar_edit_div #tool_type').change(function(){if($jq('#toolbar_edit_div #tool_type').val()=='Wikiplugin'){$jq('#toolbar_edit_div #tool_plugin').removeAttr('disabled');}else{$jq('#toolbar_edit_div #tool_plugin').attr('disabled','disabled').val("");}});$jq("#toolbar_edit_div").dialog({bgiframe:true,autoOpen:false,modal:true,buttons:{Cancel:function(){$jq(this).dialog('close');},'Save':function(){var bValid=true;if(bValid){$jq("#toolbar_edit_div #save_tool").val('Save');$jq("#toolbar_edit_div form").submit();}$jq(this).dialog('close');},Delete:function(){if(confirm(toolbarsadmin_delete_text)){$jq("#toolbar_edit_div #delete_tool").val('Delete');$jq("#toolbar_edit_div form").submit();}$jq(this).dialog('close');}},close:function(){}});saveRows=function(){var ser,text;ser=$jq('.row').map(function(){var right_section=false;return $jq(this).children().map(function(){text="";if(!right_section&&$jq(this).css("float")=="right"){text="|";right_section=true;}if($jq(this).hasClass('qt-plugin')){text+='wikiplugin_';}text+=$jq(this).text();return text;}).get().join(",").replace(",|","|");});if(typeof(ser)=='object'&&ser.length>1){ser=$jq.makeArray(ser).join('/');}else{ser=ser[0];}$jq('#qt-form-field').val(ser.replace(',,',','));};$jq('#view_mode').change(function(){if($jq(this).val()=='both'){$jq('.qt-wiki').show();$jq('.qt-wys').show();}else if($jq(this).val()=='wiki'){$jq('.qt-wys').hide();$jq('.qt-wiki').show();}else if($jq(this).val()=='wysiwyg'){$jq('.qt-wiki').hide();$jq('.qt-wys').show();}});$jq('#toolbar_add_custom').click(function(){showToolEditForm();});});