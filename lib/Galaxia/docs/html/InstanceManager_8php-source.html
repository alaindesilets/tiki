<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>InstanceManager.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>InstanceManager.php</h1><div class="fragment"><pre>00001 &lt;?php
00002 
00005 
00008 <span class="keyword">class </span>InstanceManager <span class="keyword">extends</span> BaseManager {
00009   
00014   function InstanceManager($db) 
00015   {
00016     <span class="keywordflow">if</span>(!$db) {
00017       die(<span class="stringliteral">"Invalid db object passed to InstanceManager constructor"</span>);  
00018     }
00019     $this-&gt;db = $db;  
00020   }
00021   
00022   function get_instance_activities($iid)
00023   {
00024         $query = <span class="stringliteral">"select ga.type,ga.isInteractive,ga.isAutoRouted,gi.pId,ga.activityId,ga.name,gi.instanceId,gi.status,gia.activityId,gia.user,gi.started,gia.status as actstatus from galaxia_activities ga,galaxia_instances gi,galaxia_instance_activities gia where ga.activityId=gia.activityId and gi.instanceId=gia.instanceId and gi.instanceId=$iid"</span>;
00025     $result = $this-&gt;query($query);
00026     $ret = Array();
00027     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00028       <span class="comment">// Number of active instances</span>
00029       $ret[] = $res;
00030         }
00031         <span class="keywordflow">return</span> $ret;
00032   }
00033 
00034   function get_instance($iid)
00035   {
00036         $query = <span class="stringliteral">"select * from galaxia_instances gi where instanceId=$iid"</span>;
00037         $result = $this-&gt;query($query);
00038         $res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC);
00039         $res['workitems']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from galaxia_workitems where instanceId=$iid"</span>);
00040         <span class="keywordflow">return</span> $res;
00041   }
00042 
00043   function get_instance_properties($iid)
00044   {
00045         $prop = unserialize($this-&gt;getOne(<span class="stringliteral">"select properties from galaxia_instances gi where instanceId=$iid"</span>));
00046         <span class="keywordflow">return</span> $prop;
00047   }
00048   
00049   function set_instance_properties($iid,&amp;$prop)
00050   {
00051         $props = addslashes(serialize($prop));
00052         $query = <span class="stringliteral">"update galaxia_instances set properties='$props' where instanceId=$iid"</span>;
00053         $this-&gt;query($query);
00054   }
00055   
00056   function set_instance_owner($iid,$owner)
00057   {
00058     $query = <span class="stringliteral">"update galaxia_instances set owner='$owner' where instanceId=$iid"</span>;
00059     $this-&gt;query($query);
00060   }
00061   
00062   function set_instance_status($iid,$status)
00063   {
00064         $query = <span class="stringliteral">"update galaxia_instances set status='$status' where instanceId=$iid"</span>;
00065         $this-&gt;query($query); 
00066   }
00067   
00068   function set_instance_destination($iid,$activityId)
00069   {
00070     $query = <span class="stringliteral">"delete from galaxia_instance_activities where instanceId=$iid"</span>;
00071     $this-&gt;query($query);
00072     $query = <span class="stringliteral">"insert into galaxia_instance_activities(instanceId,activityId,user,status)</span>
00073 <span class="stringliteral">    values($iid,$activityId,'*','running')"</span>;
00074     $this-&gt;query($query);
00075   }
00076   
00077   function set_instance_user($iid,$activityId,$user)
00078   {
00079         $query = <span class="stringliteral">"update galaxia_instance_activities set user='$user', status='running' where instanceId=$iid and activityId=$activityId"</span>;
00080         $this-&gt;query($query);  
00081   }
00082   
00083   
00084 
00085 }    
00086 
00087 
00088 
00089 ?&gt;
</pre></div><hr><address style="align: right;"><small>Generated on Fri Apr 25 16:07:08 2003 for Galaxia by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
