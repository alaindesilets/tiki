<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>tiki-g-admin_shared_source.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>tiki-g-admin_shared_source.php</h1><div class="fragment"><pre>00001 &lt;?php
00002 require_once('tiki-setup.php');
00003 include_once('lib/Galaxia/<a class="code" href="classProcessManager.html">ProcessManager</a>.php');
00004 
00005 <span class="comment">// The galaxia source editor for activities and</span>
00006 <span class="comment">// processes.</span>
00007 
00008 <span class="comment">/*</span>
00009 <span class="comment">// Check if feature is enabled and permissions</span>
00010 <span class="comment">if($feature_galaxia != 'y') {</span>
00011 <span class="comment">  $smarty-&gt;assign('msg',tra("This feature is disabled"));</span>
00012 <span class="comment">  $smarty-&gt;display("styles/$style_base/error.tpl");</span>
00013 <span class="comment">  die;  </span>
00014 <span class="comment">}</span>
00015 <span class="comment">*/</span>
00016 
00017 <span class="keywordflow">if</span>(!isset($_REQUEST['pid'])) {
00018   $smarty-&gt;assign('msg',tra(<span class="stringliteral">"No process indicated"</span>));
00019   $smarty-&gt;display(<span class="stringliteral">"styles/$style_base/error.tpl"</span>);
00020   die;  
00021 }
00022 $smarty-&gt;assign('pid',$_REQUEST['pid']);
00023 
00024 $proc_info = $processManager-&gt;get_process($_REQUEST['pid']);
00025 $proc_info['graph']=<span class="stringliteral">"lib/Galaxia/Processes/"</span>.$proc_info['normalized_name'].<span class="stringliteral">"/graph/"</span>.$proc_info['normalized_name'].<span class="stringliteral">".png"</span>;
00026 $smarty-&gt;assign('proc_info',$proc_info);
00027 
00028 $procname = $proc_info['normalized_name'];
00029 
00030 <span class="keywordflow">if</span>(!isset($_REQUEST['activityId'])) $_REQUEST['activityId']=0;
00031 $smarty-&gt;assign('activityId',$_REQUEST['activityId']);
00032 
00033 <span class="keywordflow">if</span>($_REQUEST['activityId']) {
00034   $act_info = $activityManager-&gt;get_activity($_REQUEST['pid'], $_REQUEST['activityId']);
00035   $actname = $act_info['normalized_name'];
00036 
00037   <span class="keywordflow">if</span>(isset($_REQUEST['<span class="keyword">template</span>'])) {
00038     $smarty-&gt;assign('<span class="keyword">template</span><span class="charliteral">','</span>y');
00039     $source = <span class="stringliteral">"lib/Galaxia/processes/$procname/code/templates/$actname"</span>.'.php';
00040 
00041   } <span class="keywordflow">else</span> {
00042     $smarty-&gt;assign('<span class="keyword">template</span><span class="charliteral">','</span>n');
00043     $source = <span class="stringliteral">"lib/Galaxia/processes/$procname/code/activities/$actname"</span>.'.php';
00044 
00045   }
00046   <span class="comment">// Then editing an activity</span>
00047   $smarty-&gt;assign('act_info',$act_info);
00048 } <span class="keywordflow">else</span> {
00049   <span class="comment">// Then editing shared code</span>
00050   $source = <span class="stringliteral">"lib/Galaxia/processes/$procname/code/shared.php"</span>;
00051 }
00052 
00053 
00054 
00055 <span class="keywordflow">if</span>(isset($_REQUEST['save'])) {
00056   $fp = fopen($source,<span class="stringliteral">"w"</span>);  
00057   fwrite($fp,$_REQUEST['source']);
00058   fclose($fp);
00059   <span class="keywordflow">if</span>($_REQUEST['activityId']) {
00060     $activityManager-&gt;compile_activity($_REQUEST['pid'],$_REQUEST['activityId']);
00061   }
00062 }
00063 
00064 $fp = fopen($source,<span class="stringliteral">"r"</span>);
00065 $data = fread($fp,filesize($source));
00066 fclose($fp);
00067 $smarty-&gt;assign('data',$data);
00068 
00069 
00070 
00071 $valid = $activityManager-&gt;validate_process_activities($_REQUEST['pid']);
00072 $errors = Array();
00073 <span class="keywordflow">if</span>(!$valid) {
00074   $errors = $activityManager-&gt;get_error();
00075 }
00076 $smarty-&gt;assign('errors',$errors);
00077 
00078 
00079 $activities = $activityManager-&gt;list_activities($_REQUEST['pid'],0,-1,'name_asc<span class="charliteral">','</span>');
00080 $smarty-&gt;assign_by_ref('items',$activities['data']);
00081 
00082 
00083 $smarty-&gt;assign('mid<span class="charliteral">','</span>tiki-g-admin_shared_source.tpl');
00084 $smarty-&gt;display(<span class="stringliteral">"styles/$style_base/tiki.tpl"</span>);
00085 ?&gt;  
</pre></div><hr><address style="align: right;"><small>Generated on Mon Apr 14 11:52:00 2003 for Galaxia by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
