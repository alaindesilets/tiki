<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>tiki-g-map_roles.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>tiki-g-map_roles.php</h1><div class="fragment"><pre>00001 &lt;?php
00002 require_once('tiki-setup.php');
00003 include_once('lib/Galaxia/<a class="code" href="classProcessManager.html">ProcessManager</a>.php');
00004 
00005 <span class="comment">// The galaxia roles manager PHP script.</span>
00006 
00007 <span class="comment">/*</span>
00008 <span class="comment">// Check if feature is enabled and permissions</span>
00009 <span class="comment">if($feature_galaxia != 'y') {</span>
00010 <span class="comment">  $smarty-&gt;assign('msg',tra("This feature is disabled"));</span>
00011 <span class="comment">  $smarty-&gt;display("styles/$style_base/error.tpl");</span>
00012 <span class="comment">  die;  </span>
00013 <span class="comment">}</span>
00014 <span class="comment">*/</span>
00015 
00016 <span class="keywordflow">if</span>(!isset($_REQUEST['pid'])) {
00017   $smarty-&gt;assign('msg',tra(<span class="stringliteral">"No process indicated"</span>));
00018   $smarty-&gt;display(<span class="stringliteral">"styles/$style_base/error.tpl"</span>);
00019   die;  
00020 }
00021 $smarty-&gt;assign('pid',$_REQUEST['pid']);
00022 
00023 $proc_info = $processManager-&gt;get_process($_REQUEST['pid']);
00024 $smarty-&gt;assign('proc_info',$proc_info);
00025 
00026 <span class="keywordflow">if</span>(!isset($_REQUEST['find_users'])) $_REQUEST['find_users']='';
00027 $smarty-&gt;assign('find_users',$_REQUEST['find_users']);
00028 $users = $userlib-&gt;get_users(0,-1,'login_asc', $_REQUEST['find_users']);
00029 $smarty-&gt;assign_by_ref('users',$users['data']);
00030 
00031 $roles = $roleManager-&gt;list_roles($_REQUEST['pid'],0,-1,'name_asc<span class="charliteral">','</span>');
00032 $smarty-&gt;assign_by_ref('roles',$roles['data']);
00033 
00034 <span class="keywordflow">if</span>(isset($_REQUEST[<span class="stringliteral">"delete"</span>])) {
00035   foreach(array_keys($_REQUEST[<span class="stringliteral">"map"</span>]) as $item) {              
00036     $parts = explode(':::',$item);
00037     $roleManager-&gt;remove_mapping($parts[0],$parts[1]);
00038   }
00039 }
00040 
00041 
00042 <span class="keywordflow">if</span>(isset($_REQUEST['save'])) {
00043   <span class="keywordflow">if</span>(isset($_REQUEST['user'])  &amp;&amp; isset($_REQUEST['role'])) {
00044     foreach($_REQUEST['user'] as $user) {
00045       foreach($_REQUEST['role'] as $role) {
00046                 $roleManager-&gt;map_user_to_role($_REQUEST['pid'],$user,$role);    
00047       }
00048     }
00049   }
00050   
00051 }
00052 
00053 <span class="comment">// list mappings</span>
00054 <span class="keywordflow">if</span>(!isset($_REQUEST[<span class="stringliteral">"sort_mode"</span>])) {  $sort_mode = 'name_asc'; } <span class="keywordflow">else</span> {  $sort_mode = $_REQUEST[<span class="stringliteral">"sort_mode"</span>];} 
00055 <span class="keywordflow">if</span>(!isset($_REQUEST[<span class="stringliteral">"offset"</span>])) {  $offset = 0;} <span class="keywordflow">else</span> {  $offset = $_REQUEST[<span class="stringliteral">"offset"</span>]; }$smarty-&gt;assign_by_ref('offset',$offset);
00056 <span class="keywordflow">if</span>(isset($_REQUEST[<span class="stringliteral">"find"</span>])) { $find = $_REQUEST[<span class="stringliteral">"find"</span>];  } <span class="keywordflow">else</span> {  $find = ''; } $smarty-&gt;assign('find',$find);
00057 $smarty-&gt;assign_by_ref('sort_mode',$sort_mode);
00058 $items = $roleManager-&gt;list_mappings($_REQUEST['pid'],$offset,$maxRecords,$sort_mode,$find);
00059 $smarty-&gt;assign('cant',$items['cant']);
00060 $cant_pages = ceil($items[<span class="stringliteral">"cant"</span>] / $maxRecords);$smarty-&gt;assign_by_ref('cant_pages',$cant_pages);$smarty-&gt;assign('actual_page',1+($offset/$maxRecords));
00061 <span class="keywordflow">if</span>($items[<span class="stringliteral">"cant"</span>] &gt; ($offset+$maxRecords)) {  $smarty-&gt;assign('next_offset',$offset + $maxRecords);} <span class="keywordflow">else</span> {  $smarty-&gt;assign('next_offset',-1); }
00062 <span class="keywordflow">if</span>($offset&gt;0) {  $smarty-&gt;assign('prev_offset',$offset - $maxRecords);  } <span class="keywordflow">else</span> {  $smarty-&gt;assign('prev_offset',-1); }
00063 $smarty-&gt;assign_by_ref('items',$items[<span class="stringliteral">"data"</span>]);
00064 
00065 
00066 
00067 $valid = $activityManager-&gt;validate_process_activities($_REQUEST['pid']);
00068 $errors = Array();
00069 <span class="keywordflow">if</span>(!$valid) {
00070   $errors = $activityManager-&gt;get_error();
00071 }
00072 $smarty-&gt;assign('errors',$errors);
00073 
00074 
00075 $smarty-&gt;assign('mid<span class="charliteral">','</span>tiki-g-map_roles.tpl');
00076 $smarty-&gt;display(<span class="stringliteral">"styles/$style_base/tiki.tpl"</span>);
00077 ?&gt;
</pre></div><hr><address style="align: right;"><small>Generated on Mon Apr 14 11:52:00 2003 for Galaxia by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
