<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Galaxia: ProcessMonitor.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ProcessMonitor.php</h1><div class="fragment"><pre>00001 &lt;?php
00002 include_once(GALAXIA_LIBRARY.'/src/common/<a class="code" href="classBase.html">Base</a>.php');
00005 
<a name="l00008"></a><a class="code" href="classProcessMonitor.html">00008</a> <span class="keyword">class </span><a class="code" href="classProcessMonitor.html">ProcessMonitor</a> <span class="keyword">extends</span> <a class="code" href="classBase.html">Base</a> {
00009 
00010   function monitor_stats() {
00011     $res = Array();
00012     $res['active_processes'] = $this-&gt;getOne(<span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes` where `isActive`=?"</span>,array(<span class="charliteral">'y'</span>));
00013     $res['processes'] = $this-&gt;getOne(<span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes`"</span>);
00014     $result = $this-&gt;query(<span class="stringliteral">"select distinct(`pId`) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `status`=?"</span>,array('active'));
00015                 <span class="comment">// echo"&lt;pre&gt;";print_r($result);echo"&lt;/pre&gt;";</span>
00016     $res['running_processes'] = $result-&gt;numRows();
00017     $res['active_instances'] = $this-&gt;getOne(<span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `status`=?"</span>,array(<span class="stringliteral">"active"</span>));
00018     $res['completed_instances'] = $this-&gt;getOne(<span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `status`=?"</span>,array(<span class="stringliteral">"completed"</span>));
00019     $res['exception_instances'] = $this-&gt;getOne(<span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `status`=?"</span>,array(<span class="stringliteral">"exception"</span>));
00020     $res['aborted_instances'] = $this-&gt;getOne(<span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `status`=?"</span>,array(<span class="stringliteral">"aborted"</span>));
00021     <span class="keywordflow">return</span> $res;
00022   }
00023   
00024   function update_instance_status($iid,$status) {
00025         $query = <span class="stringliteral">"update `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` set `status`=? where `instanceId`=?"</span>;
00026         $this-&gt;query($query,array($status,$iid));
00027   }
00028   
00029   function update_instance_activity_status($iid,$activityId,$status) {
00030         $query = <span class="stringliteral">"update `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities` set `status`=? where `instanceId`=? and `activityId`=?"</span>;
00031         $this-&gt;query($query,array($status,$iid,$activityId));
00032   
00033   }
00034   
00035   function remove_instance($iid) {
00036                 $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems` where `instanceId`=?"</span>;
00037                 $this-&gt;query($query,array($iid));
00038                 $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities` where `instanceId`=?"</span>;
00039                 $this-&gt;query($query,array($iid));
00040                 $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `instanceId`=?"</span>;
00041                 $this-&gt;query($query,array($iid));  
00042   }
00043   
00044   function remove_aborted() {
00045         
00046         $query=<span class="stringliteral">"select `instanceId` from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `status`=?"</span>;
00047         $result = $this-&gt;query($query,array('aborted'));
00048         <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {   
00049                 $iid = $res['instanceId'];
00050                 $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities` where `instanceId`=?"</span>;
00051           $this-&gt;query($query,array($iid));
00052           $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems` where `instanceId`=?"</span>;
00053           $this-&gt;query($query,array($iid));  
00054         }
00055         $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `status`=?"</span>;
00056         $this-&gt;query($query,array('aborted'));
00057         
00058   }
00059 
00060   function remove_all($pId) {
00061                 $query=<span class="stringliteral">"select `instanceId` from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `pId`=?"</span>;
00062                 $result = $this-&gt;query($query,array($pId));
00063                 <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {   
00064                         $iid = $res['instanceId'];
00065                         $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities` where `instanceId`=?"</span>;
00066                         $this-&gt;query($query,array($iid));
00067                         $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems` where `instanceId`=?"</span>;
00068                         $this-&gt;query($query,array($iid));  
00069                 }
00070                 $query = <span class="stringliteral">"delete from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` where `pId`=?"</span>;
00071                 $this-&gt;query($query,array($pId));
00072   }
00073 
00074   
00075   function monitor_list_processes($offset,$maxRecords,$sort_mode,$find,$where='') {
00076     $sort_mode = str_replace(<span class="stringliteral">"_"</span>,<span class="stringliteral">" "</span>,$sort_mode);
00077     <span class="keywordflow">if</span>($find) {
00078                         $findesc = $this-&gt;qstr(<span class="charliteral">'%'</span>.$find.<span class="charliteral">'%'</span>);
00079       $mid=<span class="stringliteral">" where ((name like $findesc) or (description like $findesc))"</span>;
00080     } <span class="keywordflow">else</span> {
00081       $mid=<span class="stringliteral">""</span>;
00082     }
00083     <span class="keywordflow">if</span>($where) {
00084       <span class="keywordflow">if</span>($mid) {
00085         $mid.= <span class="stringliteral">" and ($where) "</span>;
00086       } <span class="keywordflow">else</span> {
00087         $mid.= <span class="stringliteral">" where ($where) "</span>;
00088       }
00089     }
00090     $query = <span class="stringliteral">"select * from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes $mid order by $sort_mode limit $offset,$maxRecords"</span>;
00091     $query_cant = <span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes $mid"</span>;
00092     $result = $this-&gt;query($query);
00093     $cant = $this-&gt;getOne($query_cant);
00094     $ret = Array();
00095     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00096       <span class="comment">// Number of active instances</span>
00097       $res['active_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances where status='active' and pId="</span>.$res['pId']);
00098       <span class="comment">// Number of exception instances</span>
00099       $res['exception_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances where status='exception' and pId="</span>.$res['pId']);
00100       <span class="comment">// Number of completed instances</span>
00101       $res['completed_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances where status='completed' and pId="</span>.$res['pId']);
00102       <span class="comment">// Number of aborted instances</span>
00103       $res['aborted_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances where status='aborted' and pId="</span>.$res['pId']);
00104       $res['all_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances where pId="</span>.$res['pId']);
00105       <span class="comment">// Number of activities</span>
00106       $res['activities']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities where pId="</span>.$res['pId']);
00107       $ret[] = $res;
00108     }
00109     $retval = Array();
00110     $retval[<span class="stringliteral">"data"</span>] = $ret;
00111     $retval[<span class="stringliteral">"cant"</span>] = $cant;
00112     <span class="keywordflow">return</span> $retval;
00113   }
00114 
00115   function monitor_list_activities($offset,$maxRecords,$sort_mode,$find,$where='') {
00116     $sort_mode = str_replace(<span class="stringliteral">"_"</span>,<span class="stringliteral">" "</span>,$sort_mode);
00117     <span class="keywordflow">if</span>($find) {
00118         $findesc = $this-&gt;qstr(<span class="charliteral">'%'</span>.$find.<span class="charliteral">'%'</span>);
00119       $mid=<span class="stringliteral">" where ((name like $findesc) or (description like $findesc))"</span>;
00120     } <span class="keywordflow">else</span> {
00121       $mid=<span class="stringliteral">""</span>;
00122     }
00123     <span class="keywordflow">if</span>($where) {
00124       <span class="keywordflow">if</span>($mid) {
00125         $mid.= <span class="stringliteral">" and ($where) "</span>;
00126       } <span class="keywordflow">else</span> {
00127         $mid.= <span class="stringliteral">" where ($where) "</span>;
00128       }
00129     }
00130     $query = <span class="stringliteral">"select * from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities $mid order by $sort_mode limit $offset,$maxRecords"</span>;
00131     $query_cant = <span class="stringliteral">"select count(*) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities $mid"</span>;
00132     $result = $this-&gt;query($query);
00133     $cant = $this-&gt;getOne($query_cant);
00134     $ret = Array();
00135     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00136       <span class="comment">// Number of active instances</span>
00137       $aid = $res['activityId'];
00138       $res['active_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(gi.instanceId) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances gi,"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities gia where gi.instanceId=gia.instanceId and gia.activitYId=$aid and gi.status='active' and pId="</span>.$res['pId']);
00139       $res['completed_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(gi.instanceId) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances gi,"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities gia where gi.instanceId=gia.instanceId and gia.activityId=$aid and gi.status='completed' and pId="</span>.$res['pId']);
00140       $res['aborted_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(gi.instanceId) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances gi,"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities gia where gi.instanceId=gia.instanceId and gia.activityId=$aid and gi.status='aborted' and pId="</span>.$res['pId']);
00141       $res['exception_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(gi.instanceId) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances gi,"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities gia where gi.instanceId=gia.instanceId and gia.activityId=$aid and gi.status='exception' and pId="</span>.$res['pId']);
00142           $res['act_running_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(gi.instanceId) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances gi,"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities gia where gi.instanceId=gia.instanceId and gia.activityId=$aid and gia.status='running' and pId="</span>.$res['pId']);      
00143       $res['act_completed_instances']=$this-&gt;getOne(<span class="stringliteral">"select count(gi.instanceId) from "</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances gi,"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities gia where gi.instanceId=gia.instanceId and gia.activityId=$aid and gia.status='completed' and pId="</span>.$res['pId']);
00144       $ret[] = $res;
00145     }
00146     $retval = Array();
00147     $retval[<span class="stringliteral">"data"</span>] = $ret;
00148     $retval[<span class="stringliteral">"cant"</span>] = $cant;
00149     <span class="keywordflow">return</span> $retval;
00150   }
00151 
00152   function monitor_list_instances($offset,$maxRecords,$sort_mode,$find,$where='',$wherevars) {
00153     <span class="keywordflow">if</span>($find) {
00154                         $findesc = $this-&gt;qstr(<span class="charliteral">'%'</span>.$find.<span class="charliteral">'%'</span>);
00155       $mid=<span class="stringliteral">" where ((`properties` like ?)"</span>;
00156                         $wherevars[] = $findesc;
00157     } <span class="keywordflow">else</span> {
00158       $mid=<span class="stringliteral">""</span>;
00159     }
00160     <span class="keywordflow">if</span>($where) {
00161       <span class="keywordflow">if</span>($mid) {
00162         $mid.= <span class="stringliteral">" and ($where) "</span>;
00163       } <span class="keywordflow">else</span> {
00164         $mid.= <span class="stringliteral">" where ($where) "</span>;
00165       }
00166     }
00167     $query = <span class="stringliteral">"select gp.`pId`, ga.`isInteractive`, gi.`owner`, gp.`name` as `procname`, gp.`version`, ga.`type`,"</span>;
00168                 $query.= <span class="stringliteral">" ga.`activityId`, ga.`name`, gi.`instanceId`, gi.`status`, gia.`activityId`, gia.`user`, gi.`started`, gia.`status` as actstatus "</span>;
00169                 $query.=<span class="stringliteral">" from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` gi LEFT JOIN `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities` gia ON gi.`instanceId`=gia.`instanceId` "</span>;
00170                 $query.= <span class="stringliteral">"LEFT JOIN `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities` ga ON gia.`activityId` = ga.`activityId` "</span>;
00171                 $query.= <span class="stringliteral">"LEFT JOIN `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes` gp ON gp.`pId`=gi.`pId` $mid order by "</span>.$this-&gt;convert_sortmode($sort_mode);   
00172 
00173     $query_cant = <span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances` gi LEFT JOIN `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities` gia ON gi.`instanceId`=gia.`instanceId` "</span>;
00174                 $query_cant.= <span class="stringliteral">"LEFT JOIN `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities` ga ON gia.`activityId` = ga.`activityId` LEFT JOIN `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes` gp ON gp.`pId`=gi.`pId` $mid"</span>;
00175     $result = $this-&gt;query($query,$wherevars,$maxRecords,$offset);
00176     $cant = $this-&gt;getOne($query_cant,$wherevars);
00177     $ret = Array();
00178     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00179       $iid = $res['instanceId'];
00180       $res['workitems']=$this-&gt;getOne(<span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems` where `instanceId`=?"</span>,array($iid));
00181       $ret[] = $res;
00182     }
00183     $retval = Array();
00184     $retval[<span class="stringliteral">"data"</span>] = $ret;
00185     $retval[<span class="stringliteral">"cant"</span>] = $cant;
00186     <span class="keywordflow">return</span> $retval;
00187   }
00188 
00189 
00190   function monitor_list_all_processes($sort_mode) {
00191     $query = <span class="stringliteral">"select distinct(`name`),`pId` from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes` order by "</span>.$this-&gt;convert_sortmode($sort_mode);
00192     $result = $this-&gt;query($query);
00193     $ret = Array();
00194     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00195       $ret[] = $res;
00196     }
00197     <span class="keywordflow">return</span> $ret;
00198   }
00199   
00200   function monitor_list_statuses() {
00201     $query = <span class="stringliteral">"select distinct(`status`) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances`"</span>;
00202     $result = $this-&gt;query($query);
00203     $ret = Array();
00204     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00205       $ret[] = $res['status'];
00206     }
00207     <span class="keywordflow">return</span> $ret;
00208   }
00209   
00210   function monitor_list_users() {
00211     $query = <span class="stringliteral">"select distinct(`user`) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instance_activities`"</span>;
00212     $result = $this-&gt;query($query);
00213     $ret = Array();
00214     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00215       $ret[] = $res['user'];
00216     }
00217     <span class="keywordflow">return</span> $ret;
00218   }
00219 
00220   function monitor_list_wi_users() {
00221     $query = <span class="stringliteral">"select distinct(`user`) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems`"</span>;
00222     $result = $this-&gt;query($query);
00223     $ret = Array();
00224     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00225       $ret[] = $res['user'];
00226     }
00227     <span class="keywordflow">return</span> $ret;
00228   }
00229 
00230   
00231   function monitor_list_owners() {
00232     $query = <span class="stringliteral">"select distinct(`owner`) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"instances`"</span>;
00233     $result = $this-&gt;query($query);
00234     $ret = Array();
00235     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00236       $ret[] = $res['owner'];
00237     }
00238     <span class="keywordflow">return</span> $ret;
00239   }
00240   
00241   
00242   function monitor_list_activity_types() {
00243     $query = <span class="stringliteral">"select distinct(`type`) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities`"</span>;
00244     $result = $this-&gt;query($query);
00245     $ret = Array();
00246     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00247       $ret[] = $res['type'];
00248     }
00249     <span class="keywordflow">return</span> $ret;  
00250   }
00251   
00252   function monitor_get_workitem($itemId) {
00253     $query = <span class="stringliteral">"select gw.`orderId`,ga.`name`,ga.`type`,ga.`isInteractive`,gp.`name` as `procname`,gp.`version`,"</span>;
00254                 $query.= <span class="stringliteral">"gw.`itemId`,gw.`properties`,gw.`user`,`started`,`ended`-`started` as duration "</span>;
00255                 $query.= <span class="stringliteral">"from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems` gw,`"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities` ga,`"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes` gp where ga.`activityId`=gw.`activityId` and ga.`pId`=gp.`pId` and `itemId`=?"</span>;
00256     $result = $this-&gt;query($query, array($itemId));
00257     $res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC);
00258     $res['properties'] = unserialize($res['properties']);
00259     <span class="keywordflow">return</span> $res;
00260   }
00261 
00262   <span class="comment">// List workitems per instance, remove workitem, update_workitem</span>
00263   function monitor_list_workitems($offset,$maxRecords,$sort_mode,$find,$where='',$wherevars=array()) {
00264                 $mid = '';
00265     <span class="keywordflow">if</span> ($where) {
00266                         $mid.= <span class="stringliteral">" and ($where) "</span>;
00267     }
00268     <span class="keywordflow">if</span>($find) {
00269                         $findesc = $this-&gt;qstr(<span class="charliteral">'%'</span>.$find.<span class="charliteral">'%'</span>);
00270       $mid.=<span class="stringliteral">" and ((`properties` like ?) or (`name` like ?))"</span>;
00271                         $wherevars[] = $findesc;
00272                         $wherevars[] = $findesc;
00273     }
00274     $query = <span class="stringliteral">"select `itemId`,`ended`-`started` as duration,ga.`isInteractive`, ga.`type`,gp.`name` as procname,gp.`version`,ga.`name` as actname,"</span>;
00275                 $query.= <span class="stringliteral">"ga.`activityId`,`instanceId`,`orderId`,`properties`,`started`,`ended`,`user` from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems` gw,`"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities` ga,`"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes` gp "</span>;
00276                 $query.= <span class="stringliteral">"where gw.`activityId`=ga.`activityId` and ga.`pId`=gp.`pId` $mid order by gp.`pId` desc,"</span>.$this-&gt;convert_sortmode($sort_mode);
00277     $query_cant = <span class="stringliteral">"select count(*) from `"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"workitems` gw,`"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"activities` ga,`"</span>.GALAXIA_TABLE_PREFIX.<span class="stringliteral">"processes` gp where gw.`activityId`=ga.`activityId` and ga.`pId`=gp.`pId` $mid"</span>;
00278     $result = $this-&gt;query($query,$wherevars,$maxRecords,$offset);
00279     $cant = $this-&gt;getOne($query_cant,$wherevars);
00280     $ret = Array();
00281     <span class="keywordflow">while</span>($res = $result-&gt;fetchRow(DB_FETCHMODE_ASSOC)) {
00282       $ret[] = $res;
00283     }
00284     $retval = Array();
00285     $retval[<span class="stringliteral">"data"</span>] = $ret;
00286     $retval[<span class="stringliteral">"cant"</span>] = $cant;
00287     <span class="keywordflow">return</span> $retval;
00288   }
00289   
00290 
00291 }
00292 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Sep 30 01:24:13 2003 for Galaxia by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
