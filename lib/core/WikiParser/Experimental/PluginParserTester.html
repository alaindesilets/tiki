<html>
	<head>
		<script src="../../../jquery/jquery.js"></script> 
		<script src="PluginParser.js"></script>
		<script style="text/javascript">
			function wikiplugin_nobody() {
				return "This plugin has no body";
			}
			
			function wikiplugin_purple(body) {
				return "{RED()}This is nested: " + body + "{RED}";
			}
			
			function wikiplugin_li(body) {
				return "<ul><li>" + body + "</li></ul>";
			}
			
			function wikiplugin_red(body) {
				return "<div style='color: red; border: 1px solid red;'>" + body + "</div>";
			}
			
			function wikiplugin_blue(body) {
				return "<div style='color: blue; border: 1px solid blue;'>" + body + "</div>";
			}
			
			function wikiplugin_bgyellow(body) {
				return "<div style='background-color: yellow;'>" + body + "</div>";
			}
			
			function isPermissible(pluginName) {
				var permission = false;
				switch(pluginName) {
					case "BLUE":
						permission = false;
						break;
					default:
						permission = true;
				}
				return permission;
			}
			
			function plugin(plugin) {
				if (!isPermissible(plugin.name)) return "";
			
				var wikiPluginName = "wikiplugin_" + plugin.name.toLowerCase();
				if (window[wikiPluginName]) {
					var thisOutput = window[wikiPluginName](plugin.body);
					if (thisOutput) {
						var newOutput = tryParse(thisOutput);
						
						return (newOutput ? newOutput : thisOutput);
					}
				}
				return plugin.body;
			}
			
			function tryParse(val) {
				try {
					//ready the sheet's parser
					function Lexer () {}
					Lexer.prototype = PluginParser.lexer;

					function Parser () {
						this.lexer = new Lexer();
						this.yy = {};
					}
					Parser.prototype = PluginParser;
					
					var parser = (new Parser);
					return parser.parse(val);
				} catch (e) {
				//	alert(e);
				}
			}
			
			$(function(){
				$('#runParser')
					.click(function() {
						$('#output').html(tryParse($('#wiki').val()));
					});
				$('#wiki')
					.change(function() {
						$('#output').html(tryParse($('#wiki').val()));
					})
					.keyup(function() {
						$('#output').html(tryParse($('#wiki').val()));
					})
					.change();
			});
		</script>
	</head>
	<body>
	This is an example plugin parsing syntax for using with Jison's parser for wiki syntax in javascript, this is a temporary file and is only a proof of concept.
	<textarea id="wiki" style="width: 100%; height: 150px;">
!Header
(test|test)
[test|test]
((test))

||Table|Talbe||

{nobody param1="100" /}
{BGYELLOW(testVar1="Test")}
	{LI()}
		{PURPLE()}purple returns a nested plugin!{PURPLE}
	{LI}
	{LI()}
		This is just some text
			{RED()}My plugin message!{RED}
		And after too.
		{BLUE()}
			This is nested within the first plugin.
		{BLUE}
		{nobody /}
		{LI()}
			Hello World 1!
			{LI()}
				Hello World! 2
			{LI}
			
			{BLUE()}
				This is nested within the second hello world li.
			{BLUE}
			
			End Hello World 1
		{LI}
		And at the end.
	{LI}
	I'm in the yellow!
{BGYELLOW}
	</textarea>
	<input type="button" value="Submit" id="runParser"/>
	<div id="output"></div>
	</body>
</html>