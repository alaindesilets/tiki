<html>
	<head>
		<script src="../../../jquery/jquery.js"></script>
		<link rel="stylesheet" href="../../../jquery/jquery-ui/themes/base/jquery-ui.css" type="text/css" media="all" /> 
		<script src="../../../jquery/jquery-ui/ui/jquery-ui.js" type="text/javascript"></script> 
		
		<link rel="stylesheet" href="../../../codemirror/lib/codemirror.css" type="text/css" />
		<link rel="stylesheet" href="../../../codemirror/theme/default.css" type="text/css" />

		<script src="../../../codemirror/lib/codemirror.js"></script>
		<script src="../../../codemirror_tiki/codemirror_tiki.js"></script>
		
		<script src="PluginParser.js"></script>
		<script style="text/javascript">
			function wikiplugin_nobody() {
				return "This plugin has no body";
			}
			
			function wikiplugin_purple(body) {
				return "{RED()}This is nested: " + body + "{RED}";
			}
			
			function wikiplugin_li(body) {
				return "<ul><li>" + body + "</li></ul>";
			}
			
			function wikiplugin_red(body) {
				return "<div style='color: red; border: 1px solid red;'>" + body + "</div>";
			}
			
			function wikiplugin_blue(body) {
				return "<div style='color: blue; border: 1px solid blue;'>" + body + "</div>";
			}
			
			function wikiplugin_bgyellow(body) {
				return "<div style='background-color: yellow;'>" + body + "</div>";
			}
			
			function isPermissible(pluginName) {
				var permission = false;
				switch(pluginName) {
					case "BLUE":
						permission = false;
						break;
					default:
						permission = true;
				}
				return permission;
			}
			
			function plugin(plugin) {
				if (!isPermissible(plugin.name)) return "<div style='background-color: red; color: white;'>Plugin " + plugin.name + " Not Permissible</div>";
			
				var wikiPluginName = "wikiplugin_" + plugin.name.toLowerCase();
				if (window[wikiPluginName]) {
					var thisOutput = window[wikiPluginName](plugin.body);
					if (thisOutput) {
						var newOutput = tryParse(thisOutput);
						
						return (newOutput ? newOutput : thisOutput);
					}
				}
				return plugin.body;
			}
			
			function tryParse(val) {
				try {
					function PLexer () {}
					PLexer.prototype = PluginParser.lexer;

					function PParser () {
						this.lexer = new PLexer();
						this.yy = {};
					}
					PParser.prototype = PluginParser;
					
					var pparser = (new PParser);
					
					return pparser.parse(val);
				} catch (e) {
					/*$('<pre />')
						.html(e + '')
						.dialog();*/
				}
			}
			
			$(function(){
				syntaxHighlighter.ready($('#wiki'), {readOnly: false, changeText: ''});
				
				var editor = syntaxHighlighter.get($('#wiki'));
				
				$('#runParser')
					.click(function() {
						$('#output').html(tryParse(editor.getValue()));
					});
				$('#wiki')
					.change(function() {
						$('#output').html(tryParse(editor.getValue()));
					})
					.keyup(function() {
						$('#output').html(tryParse(editor.getValue()));
					})
					.change();
			});
		</script>
	</head>
	<body>
	This is an example plugin parsing syntax for using with Jison's parser for wiki syntax in javascript, this is a temporary file and is only a proof of concept.
	<textarea id="wiki" style="width: 100%; height: 150px;">
__italics__
''bold''

''__Here is bold and italics!__''

{nobody param1="100" /}
{BGYELLOW(testVar1="Test")}
	{LI()}
		{PURPLE()}purple returns a nested plugin!{PURPLE}
	{LI}
	{LI()}
		This is just some text
			{RED()}My plugin message!{RED}
		And after too.
		{BLUE()}
			This is nested within the first plugin.
		{BLUE}
		{nobody /}
		{LI()}
			Hello World 1!
			{LI()}
				Hello World! 2
			{LI}
			
			{BLUE()}
				This is nested within the second hello world li.
			{BLUE}
			
			End Hello World 1
		{LI}
		And at the end.
	{LI}
	I'm in the yellow!
{BGYELLOW}
	</textarea>
	<input type="button" value="Submit" id="runParser"/>
	<div id="output"></div>
	</body>
</html>