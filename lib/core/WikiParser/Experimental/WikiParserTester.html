<html>
	<head>
		<script src="../../../jquery/jquery.js"></script>
		<link rel="stylesheet" href="../../../jquery/jquery-ui/themes/base/jquery-ui.css" type="text/css" media="all" /> 
		<script src="../../../jquery/jquery-ui/ui/jquery-ui.js" type="text/javascript"></script> 
		
		<link rel="stylesheet" href="../../../codemirror/lib/codemirror.css" type="text/css" />
		<link rel="stylesheet" href="../../../codemirror/theme/default.css" type="text/css" />

		<script src="../../../codemirror/lib/codemirror.js"></script>
		<script src="../../../codemirror_tiki/codemirror_tiki.js"></script>
		
		<script src="WikiParser.js"></script>
		<script style="text/javascript">
			function wikiplugin_nobody() {
				return "__This plugin has no body__";
			}
			
			function wikiplugin_purple(body) {
				return "{RED()}This is nested: " + body + "{RED}";
			}
			
			function wikiplugin_li(body) {
				return "~np~<ul><li>" + body + "</li></ul>~/np~";
			}
			
			function wikiplugin_red(body) {
				return "~np~<div style='color: red; border: 1px solid red;'>" + body + "</div>~/np~";
			}
			
			function wikiplugin_blue(body) {
				return "~np~<div style='color: blue; border: 1px solid blue;'>" + body + "</div>~/np~";
			}
			
			function wikiplugin_bgyellow(body) {
				return "~np~<div style='background-color: yellow;'>" + body + "</div>~/np~";
			}
			
			function isPluginPermissible(pluginName) {
				var permission = false;
				switch(pluginName) {
					case "BLUE":
						permission = false;
						break;
					default:
						permission = true;
				}
				return permission;
			}
			
			function isHtmlPermissible(tag) {
				if ($('#HtmlOn').is(':checked')) {
					return tag;
				}
				return "";
			}
			
			function plugin(plugin) {
				if (!isPluginPermissible(plugin.name)) return "<div style='background-color: red; color: white;'>Plugin " + plugin.name + " Not Permissible</div>";
			
				var wikiPluginName = "wikiplugin_" + plugin.name.toLowerCase();
				if (window[wikiPluginName]) {
					var thisOutput = window[wikiPluginName](plugin.body);
					if (thisOutput) {
						var newOutput = tryParse(thisOutput);
						
						return (newOutput ? newOutput : thisOutput);
					}
				}
				return plugin.body;
			}
			
			function tryParse(val) {
				try {
					function Lexer () {}
					Lexer.prototype = WikiParser.lexer;

					function Parser () {
						this.lexer = new Lexer();
						this.yy = {};
					}
					Parser.prototype = WikiParser;
					
					var wikiParser = (new Parser);
					
					return wikiParser.parse(val);
				} catch (e) {
					if ($('#errorsOn').is(':checked')) {
						$('<pre />')
							.html(e + '')
							.dialog();
					}
				}
			}
			
			$(function(){
				syntaxHighlighter.ready($('#wiki'), {readOnly: false, changeText: ''});
				
				var editor = syntaxHighlighter.get($('#wiki'));
				
				$('#runParser')
					.click(function() {
						$('#output').html(tryParse(editor.getValue()));
					});
				$('#wiki')
					.change(function() {
						$('#output').html(tryParse(editor.getValue()));
					})
					.keyup(function() {
						$('#output').html(tryParse(editor.getValue()));
					})
					.change();
			});
		</script>
	</head>
	<body>
		This is an example plugin parsing syntax for using with Jison's parser for wiki syntax in javascript, this is a temporary file and is only a proof of concept.<br />
		What does the parser definition look like? <a href="WikiParser.jison">Take a look</a><br />
		Left is updated on keyup, change, and submit.
		<table style="width: 100%;">
			<tr>
				<td style="vertical-align: top; width: 50%;">
<textarea id="wiki" style="width: 100%; height: 150px;">''italics''
__bold__

''__Here is bold and italics!__''
-=Title=-


^I am a box^

-=^''__Here is bold and italics!__ in a box'' in a title!^=-

~np~__This is unparsed wiki syntax__ {TEST()} :) {TEST} ~/np~

{nobody param1="100" /}
{BGYELLOW(testVar1="Test")}
	{LI()}{PURPLE()}purple returns a nested plugin!{PURPLE}{LI}
	{LI()}
		This is just some text
		
		{RED()}My plugin message!{RED}
		
		And after too.
		
		{BLUE()}This is nested within the first plugin.{BLUE}
		
		{nobody /}
		{LI()}
			Hello World 1!
			
			{LI()}Hello World! 2{LI}
			
			{BLUE()}This is nested within the second hello world li.{BLUE}
			
			End Hello World 1
		{LI}
		And at the end.
	{LI}
	I'm in the yellow!
{BGYELLOW}</textarea>
					Show Errors? <input type="checkbox" value="true" id="errorsOn" /> <br />
					Allow Html? <input type="checkbox" value="true" id="HtmlOn" /> <br />
					<input type="button" value="Submit" id="runParser"/>
				</td>
				<td style="width: 50%;">
					<div id="output"></div>
				</td>
			</tr>
		</table>
	</body>
</html>